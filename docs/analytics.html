<!DOCTYPE html>

<html>
<head>
  <title>analytics.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="analytics.html">
                analytics.js
              </a>
            
              
              <a class="source" href="main.html">
                main.js
              </a>
            
              
              <a class="source" href="mobile.html">
                mobile.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>analytics.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*
 Contents
 --------
 1. Utililty functions
 2. Exit Links
 3. Tracked Links
 4. File Downloads
 5. Social Tracking
 6. Newsletter Signup Form
 7. Data tracking
 8. Custom events on the Explore Data page
 9. Find and Track YouTube Videos

An analytics file to fire custom events based on on Google's ga.js:
https://developers.google.com/analytics/devguides/collection/gajs/

*/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Add in Google Analytics tracking check wrapper</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> track = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(category, name, value)</span> </span>{
<span class="hljs-pi">    'use strict'</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>._gaq) {
        <span class="hljs-built_in">window</span>._gaq.push([<span class="hljs-string">'_trackEvent'</span>, category, name, value]);
    }
}; <span class="hljs-comment">// End Google Analytics tracking check</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <ol>
<li>Utililty functions
Check if URL is internal.</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre> $(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
<span class="hljs-pi">    'use strict'</span>;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isInternalHref</span><span class="hljs-params">( href )</span> </span>{
        <span class="hljs-keyword">if</span> (href.indexOf(<span class="hljs-string">'https:'</span>) == -<span class="hljs-number">1</span> &amp;&amp; href.indexOf(<span class="hljs-string">'http:'</span>) == -<span class="hljs-number">1</span> &amp;&amp; href.indexOf(<span class="hljs-string">'//'</span>) !== <span class="hljs-number">0</span>) { <span class="hljs-comment">// There's no protocol, so it's internal</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">else</span> { <span class="hljs-comment">// There is a protocol, so we check for our domain.</span>
            <span class="hljs-keyword">if</span> (href.indexOf(<span class="hljs-string">'consumerfinance.gov'</span>) !== -<span class="hljs-number">1</span>) { <span class="hljs-comment">// It contains our domain, so it's internal.</span>
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            <span class="hljs-keyword">else</span> { <span class="hljs-comment">// There is a protocol and not our domain, so it's external.</span>
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Now, track stuff like this: track(category, name, value);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    $(<span class="hljs-built_in">document</span>).ready(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Just for testing purposes
var a = ‘<a href="http://www.consumerfinance.gov">http://www.consumerfinance.gov</a>‘;
var b = ‘<a href="http://davidakennedy.com">http://davidakennedy.com</a>‘;
var c = ‘/about’;</p>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>var testInternal = isInternalHref(a);
console.log(testInternal); // Prints true.</p>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>var testExit = isInternalHref(b);
console.log(testExit); // Prints false.</p>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>var testNoProt = isInternalHref(c);
console.log(testNoProt); // Prints true.
End testing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        $( <span class="hljs-string">'a'</span> ).not(<span class="hljs-string">'.exit-link, .internal-link'</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{ <span class="hljs-comment">// In case our links already have the class; don't include.</span>
            <span class="hljs-keyword">var</span> href = $(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">'href'</span>);
            <span class="hljs-keyword">if</span> ( !href ) {
                <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-keyword">if</span> ( isInternalHref( href ) ) { <span class="hljs-comment">// Internal links get a class; not tracked in Analytics.</span>
                $(<span class="hljs-keyword">this</span>).addClass(<span class="hljs-string">'internal-link'</span>);
            }
            <span class="hljs-keyword">else</span> { <span class="hljs-comment">// Exit links get a class; this is tracked with Analytics.</span>
                $(<span class="hljs-keyword">this</span>).addClass(<span class="hljs-string">'exit-link'</span>);
            }
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <ol>
<li>Exit Links</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(<span class="hljs-string">'a.exit-link'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
            <span class="hljs-keyword">var</span> linkDelay = <span class="hljs-number">500</span>;
            <span class="hljs-keyword">var</span> link_text = $(<span class="hljs-keyword">this</span>).text();
            <span class="hljs-keyword">var</span> link_url = $(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">'href'</span>);
            <span class="hljs-keyword">var</span> isCtrlPressed = e.ctrlKey || e.metaKey;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Stop the link from going anywhere
(it’s ok we saved the href and we’ll fire it later)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            e.preventDefault();
            <span class="hljs-keyword">try</span> { track(<span class="hljs-string">'exit link'</span>, link_text, link_url); }
            <span class="hljs-keyword">catch</span>( error ) {}

            <span class="hljs-keyword">if</span> ( !$(<span class="hljs-keyword">this</span>).hasClass(<span class="hljs-string">'dont-redirect'</span>) ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Give google analytics time to do its thing before changing the page url
<a href="http://support.google.com/analytics/answer/1136920?hl=en">http://support.google.com/analytics/answer/1136920?hl=en</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                    <span class="hljs-keyword">if</span> (isCtrlPressed) {
                        <span class="hljs-built_in">window</span>.open(link_url, <span class="hljs-string">'_blank'</span>);
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-built_in">document</span>.location.href = link_url;
                    }
                }, linkDelay);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( $(<span class="hljs-keyword">this</span>).is(<span class="hljs-string">'[target=_blank]'</span>) ) {
                <span class="hljs-built_in">window</span>.open(link_url, <span class="hljs-string">'_blank'</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-built_in">document</span>.location.href = link_url;
            }
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <ol>
<li>Tracked Links</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(<span class="hljs-string">'a.tracked-link'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
            <span class="hljs-keyword">var</span> linkDelay = <span class="hljs-number">500</span>;
            <span class="hljs-keyword">var</span> link_text = $(<span class="hljs-keyword">this</span>).text();
            <span class="hljs-keyword">var</span> link_url = $(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">'href'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Stop the link from going anywhere
(it’s ok we saved the href and we’ll fire it later)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            e.preventDefault();
            <span class="hljs-keyword">try</span> { track(<span class="hljs-string">'internal links'</span>, link_text, link_url); }
            <span class="hljs-keyword">catch</span>( error ) {}</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Give google analytics time to do its thing before changing the page url
<a href="http://support.google.com/analytics/answer/1136920?hl=en">http://support.google.com/analytics/answer/1136920?hl=en</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{ <span class="hljs-built_in">document</span>.location.href = link_url; }, linkDelay);
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <ol>
<li>File Downloads
a[href$=”pdf#page=315”] is special to CFPB Exam Manual</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(<span class="hljs-string">'a[href$="zip"],a[href$="pdf"],a[href$="pdf#page=315"],a[href$="doc"],a[href$="docx"],a[href$="xls"],a[href$="xlsx"],a[href$="ppt"],a[href$="pptx"],a[href$="txt"],a[href$="csv"],a[href$="jpg"],a[href$="jpeg"],a[href$="png"],a[href$="mov"],a[href$="wma"]'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
            <span class="hljs-keyword">var</span> linkDelay = <span class="hljs-number">500</span>;
            <span class="hljs-keyword">var</span> link_text = $(<span class="hljs-keyword">this</span>).text();
            <span class="hljs-keyword">var</span> link_url = $(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">'href'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Stop the link from going anywhere
(it’s ok we saved the href and we’ll fire it later)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            e.preventDefault();
            <span class="hljs-keyword">try</span> { track(<span class="hljs-string">'downloads'</span>, link_text, link_url); }
            <span class="hljs-keyword">catch</span>( error ) {}</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Give google analytics time to do its thing before changing the page url
<a href="http://support.google.com/analytics/answer/1136920?hl=en">http://support.google.com/analytics/answer/1136920?hl=en</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{ <span class="hljs-built_in">document</span>.location.href = link_url; }, linkDelay);
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <ol>
<li>Social Tracking
Links in the footer</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(<span class="hljs-string">'ul.social &gt; a'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{ <span class="hljs-comment">// Selector is a placeholder for redesign.</span>
            <span class="hljs-keyword">var</span> linkDelay = <span class="hljs-number">500</span>;
            <span class="hljs-keyword">var</span> link_text = $(<span class="hljs-keyword">this</span>).text();
            <span class="hljs-keyword">var</span> link_url = $(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">'href'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Stop the link from going anywhere
(it’s ok we saved the href and we’ll fire it later)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            e.preventDefault();
            <span class="hljs-keyword">try</span> { track(<span class="hljs-string">'social'</span>, link_text, link_url); }
            <span class="hljs-keyword">catch</span>( error ) {}</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Give google analytics time to do its thing before changing the page url
<a href="http://support.google.com/analytics/answer/1136920?hl=en">http://support.google.com/analytics/answer/1136920?hl=en</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{ <span class="hljs-built_in">document</span>.location.href = link_url; }, linkDelay);
        });

        <span class="hljs-comment">/* Twitter follow button */</span>
        <span class="hljs-comment">/* Follow button not needed
        if ( typeof twttr !== 'undefined' ) {
            twttr.ready(function ( twttr ) {
                twttr.events.bind( 'click', trackTwitterFollow );
            });
        }

        function trackTwitterFollow() {
            try { track('social', 'follow', 'twitter'); }
            catch( error ) {}
        } */</span>

        <span class="hljs-comment">/* Facebook Like button */</span>
        <span class="hljs-comment">/* Follow button not needed
        if ( typeof FB !== 'undefined' ) {
            FB.Event.subscribe( 'edge.create', trackFacebookLike );
        }

        function trackFacebookLike() {
            try { track('social', 'follow', 'facebook'); }
            catch( error ) {}
        } */</span>

        <span class="hljs-comment">/* Social sharing buttons */</span>
        <span class="hljs-comment">/* Facebook */</span>
        $(<span class="hljs-string">'.share-facebook'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{ <span class="hljs-comment">// Selector is a placeholder for redesign.</span>
            <span class="hljs-keyword">var</span> linkDelay = <span class="hljs-number">500</span>;
            <span class="hljs-keyword">var</span> link_url = $(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">'href'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Stop the link from going anywhere
(it’s ok we saved the href and we’ll fire it later)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            e.preventDefault();
            <span class="hljs-keyword">try</span> { track(<span class="hljs-string">'social'</span>, <span class="hljs-string">'share'</span>, <span class="hljs-string">'facebook'</span>); }
            <span class="hljs-keyword">catch</span>( error ) {}</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Give google analytics time to do its thing before changing the page url
<a href="http://support.google.com/analytics/answer/1136920?hl=en">http://support.google.com/analytics/answer/1136920?hl=en</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{ <span class="hljs-built_in">document</span>.location.href = link_url; }, linkDelay);
        });

        <span class="hljs-comment">/* Twitter */</span>
        $(<span class="hljs-string">'.share-twitter'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{ <span class="hljs-comment">// Selector is a placeholder for redesign.</span>
            <span class="hljs-keyword">var</span> linkDelay = <span class="hljs-number">500</span>;
            <span class="hljs-keyword">var</span> link_url = $(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">'href'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Stop the link from going anywhere
(it’s ok we saved the href and we’ll fire it later)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            e.preventDefault();
            <span class="hljs-keyword">try</span> { track(<span class="hljs-string">'social'</span>, <span class="hljs-string">'share'</span>, <span class="hljs-string">'twitter'</span>); }
            <span class="hljs-keyword">catch</span>( error ) {}</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Give google analytics time to do its thing before changing the page url
<a href="http://support.google.com/analytics/answer/1136920?hl=en">http://support.google.com/analytics/answer/1136920?hl=en</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{ <span class="hljs-built_in">document</span>.location.href = link_url; }, linkDelay);
        });

        <span class="hljs-comment">/* Email */</span>
        $(<span class="hljs-string">'.share-email'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{ <span class="hljs-comment">// Selector is a placeholder for redesign.</span>
            <span class="hljs-keyword">var</span> linkDelay = <span class="hljs-number">500</span>;
            <span class="hljs-keyword">var</span> link_url = $(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">'href'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Stop the link from going anywhere
(it’s ok we saved the href and we’ll fire it later)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            e.preventDefault();
            <span class="hljs-keyword">try</span> { track(<span class="hljs-string">'social'</span>, <span class="hljs-string">'share'</span>, <span class="hljs-string">'email'</span>); }
            <span class="hljs-keyword">catch</span>( error ) {}</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Give google analytics time to do its thing before changing the page url
<a href="http://support.google.com/analytics/answer/1136920?hl=en">http://support.google.com/analytics/answer/1136920?hl=en</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{ <span class="hljs-built_in">document</span>.location.href = link_url; }, linkDelay);
        });

        <span class="hljs-comment">/* 6. Newsletter signup form */</span>
        $(<span class="hljs-string">'.signup'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-string">'button'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">var</span> zip = $(<span class="hljs-keyword">this</span>).closest(<span class="hljs-string">'.signup'</span>).find(<span class="hljs-string">'questionid_10376'</span>).val();
            track(<span class="hljs-string">'social'</span>, <span class="hljs-string">'signup'</span>, <span class="hljs-string">'mailing list signup'</span>);
        });

        <span class="hljs-comment">/* Chart's underlying data on the homepage */</span>
        $(<span class="hljs-string">'a.underlying'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            track(<span class="hljs-string">'homepage'</span>, <span class="hljs-string">'underlying data link click'</span>, $(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">'data-track-label'</span>));
        });

        <span class="hljs-comment">/* On focus of text area; also fires when button is clicked */</span>
        $(<span class="hljs-string">'#share .share_url'</span>).on(<span class="hljs-string">'focus'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            track(<span class="hljs-string">'share URL link'</span>, <span class="hljs-string">'HMDA box'</span>);
        });
    }); <span class="hljs-comment">// End document ready.</span>
}); <span class="hljs-comment">// End anonymous function.</span>

(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($)</span> </span>{
<span class="hljs-pi">    'use strict'</span>;
    <span class="hljs-comment">/**
     * ========================================================================
     * 9. Find and Track YouTube Videos
     * Find YouTube videos on a page and track them with google analytics
     * ========================================================================
     * cfpb.github.com: @davidakennedy, @mikem
     *
     * YouTube Iframe API Documentation
     * https://developers.google.com/youtube/iframe_api_reference
     * 
     * Code adapted from:
     * - http://www.lunametrics.com/blog/2012/10/22/automatically-track-youtube-videos-events-google-analytics/
     * - http://lunametrics.wpengine.netdna-cdn.com/js/lunametrics-youtube.js
     * Code adapted by Alex Mueller for ISITE Design http://isitedesign.com
     */</span>

    $.fn.findAndTrackYouTubeVideos = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( )</span> </span>{

        <span class="hljs-keyword">var</span> videoObjects = [], <span class="hljs-comment">// Stores all of the videos</span></pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Simple variable to track if the event was captured once,
we had a problem with events firing more than once in firefox
and during scrubbing so this is a temporary stopgap.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            wasTriggeredOnce = {
                playing: <span class="hljs-literal">false</span>,
                ended: <span class="hljs-literal">false</span>
            };

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onPlayerStateChange</span><span class="hljs-params">( event )</span> </span>{
            <span class="hljs-keyword">var</span> videoIndex = event.target.id - <span class="hljs-number">1</span>;
            <span class="hljs-keyword">if</span> ( event.data == YT.PlayerState.PLAYING &amp;&amp; wasTriggeredOnce.playing === <span class="hljs-literal">false</span> ) {
                 wasTriggeredOnce.playing = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">try</span> { track(<span class="hljs-string">'videos'</span>, <span class="hljs-string">'play'</span>, videoObjects[videoIndex].title); }
                <span class="hljs-keyword">catch</span>( error ) {}
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( event.data == YT.PlayerState.ENDED &amp;&amp; wasTriggeredOnce.ended === <span class="hljs-literal">false</span> ) {
                 wasTriggeredOnce.ended = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">try</span> { track(<span class="hljs-string">'videos'</span>, <span class="hljs-string">'ended'</span>, videoObjects[videoIndex].title); }
                <span class="hljs-keyword">catch</span>( error ) {}
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isSrcYouTubeVideo</span><span class="hljs-params">( src )</span> </span>{
            <span class="hljs-keyword">if</span> ( !src ) {
                <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-keyword">if</span> ( src.indexOf(<span class="hljs-string">'youtube.com/embed/'</span>) !== -<span class="hljs-number">1</span> ) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getYouTubeVideoIdFromSrc</span><span class="hljs-params">( src )</span> </span>{
            <span class="hljs-keyword">var</span> videoId;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>The ID comes after ‘/embed/‘</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> ( src.substr( <span class="hljs-number">0</span>,<span class="hljs-number">24</span> ) == <span class="hljs-string">'//www.youtube.com/embed/'</span> ) {
                videoId = src.substr( <span class="hljs-number">24</span> );
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( src.substr( <span class="hljs-number">0</span>,<span class="hljs-number">29</span> ) == <span class="hljs-string">'http://www.youtube.com/embed/'</span> ) {
                videoId = src.substr( <span class="hljs-number">29</span> );
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( src.substr( <span class="hljs-number">0</span>,<span class="hljs-number">30</span> ) == <span class="hljs-string">'https://www.youtube.com/embed/'</span> ) {
                videoId = src.substr( <span class="hljs-number">30</span> );
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>If the ID ends with extra characters remove them</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> ( videoId.indexOf(<span class="hljs-string">'?'</span>) &gt; -<span class="hljs-number">1</span> ) {
                videoId = videoId.substr( <span class="hljs-number">0</span>, videoId.indexOf(<span class="hljs-string">'?'</span>) );
            }
            <span class="hljs-keyword">return</span> videoId;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkInitConditions</span><span class="hljs-params">( e )</span> </span>{
            <span class="hljs-keyword">var</span> $e = $( e ),
                isIframe = $e.is(<span class="hljs-string">'iframe'</span>),
                notAlreadyTracked = !$e.is(<span class="hljs-string">'[data-is-findAndTrackYouTubeVideos]'</span>),
                hasYouTubeSrc = isSrcYouTubeVideo( $e.attr(<span class="hljs-string">'src'</span>) );
            <span class="hljs-keyword">return</span> ( isIframe &amp;&amp; notAlreadyTracked &amp;&amp; hasYouTubeSrc );
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Loop through each object to see if it meets our init conditions. If
it does then save the info we need for tracking and attach tracking
events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ( $.fn.findAndTrackYouTubeVideos.isIframeApiReady ) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                <span class="hljs-keyword">var</span> $iframe = $( <span class="hljs-keyword">this</span> ),
                    video = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Grab the video info we’ll need to track it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> ( checkInitConditions( $iframe ) ) {
                    video.id = getYouTubeVideoIdFromSrc( $iframe.attr(<span class="hljs-string">'src'</span>) );</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Saving the title is trickier we need to pull it from the
YouTube data API</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    $.ajax({
                        dataType: <span class="hljs-string">'JSON'</span>,
                        url: <span class="hljs-string">'https://gdata.youtube.com/feeds/api/videos/'</span> + video.id + <span class="hljs-string">'?v=2&amp;alt=json'</span>
                    })
                    .done( <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span> </span>{
                        video.title = data.entry.title.$t;
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Flag this element so we know we’re tracking it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    $iframe.attr( <span class="hljs-string">'data-is-findAndTrackYouTubeVideos'</span>, <span class="hljs-string">''</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Put the video ID on the iframe as its id attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    $iframe.attr( <span class="hljs-string">'id'</span>, video.id );</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Create a player to attach events to</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    video.player = <span class="hljs-keyword">new</span> YT.Player( video.id, { events: { <span class="hljs-string">'onStateChange'</span>: onPlayerStateChange } } );</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Save the video object so the events can reference it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> ( $.inArray( video, videoObjects === -<span class="hljs-number">1</span> ) ) {
                        videoObjects.push( video );
                    }
                }
            });
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    };

    $.fn.findAndTrackYouTubeVideos.isIframeApiReady = <span class="hljs-literal">false</span>;

}(jQuery));

<span class="hljs-comment">/**
 * ============================================================================
 * YouTube API Functions
 * Keep this stuff in the global namespace
 * ============================================================================
 */</span>

<span class="hljs-keyword">var</span> tag = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'script'</span>);
tag.src = <span class="hljs-string">'//www.youtube.com/iframe_api'</span>;
<span class="hljs-keyword">var</span> firstScriptTag = <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">'script'</span>)[<span class="hljs-number">0</span>];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>This function gets called by the YouTube Iframe API
function onYouTubeIframeAPIReady() {
    ‘use strict’;
    // We’re only calling the plugin when the YouTube Iframe API is ready
    // because we need it to create YouTube player objects for tracking.
    $.fn.findAndTrackYouTubeVideos.isIframeApiReady = true;
    $(‘iframe’).findAndTrackYouTubeVideos();
}</p>

            </div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
